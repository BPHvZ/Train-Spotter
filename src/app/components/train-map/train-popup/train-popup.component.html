<!--
  ~ trainSpotter
  ~ Copyright (C) 2021 bart
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div style="pointer-events: auto" *ngIf="trainInformation" class="mat-typography">
	<div class="map-marker flex-parent-inline flex-parent--center-cross flex-parent--column absolute bottom">
		<div
			class="map-marker-content color-white shadow-darken10 round txt-s clip txt-truncate"
			style="width: fit-content"
		>
			<div class="container-fluid d-flex">
				<div class="row" style="justify-content: space-between">
					<div class="col">
						<div class="row d-flex justify-content-between" style="width: max-content">
							<h3 style="margin: unset">
								<strong>
									{{ trainInformation.trainDetails?.vervoerder }} {{ getTypeOfTrain() }} trein
									<span style="cursor: pointer" (click)="navigateToRideInformation()"
										>{{ trainInformation.ritId }}</span
									>
									<span
										*ngFor="
											let trainPart of trainInformation.trainDetails?.materieeldelen;
											let i = index
										"
									>
										<span *ngIf="trainPart.materieelnummer">
											<span *ngIf="i == 0; else other">
												met
												<span
													style="cursor: pointer"
													(click)="navigateToTrainsetInformation(trainPart.materieelnummer)"
													>{{ trainPart.materieelnummer }}</span
												></span
											>
											<ng-template #other
												>{{i == (trainInformation.trainDetails.materieeldelen.length - 1) ? ' '
												+ 'en' : ','}} {{ trainPart.materieelnummer }}
											</ng-template>
										</span>
									</span>
								</strong>
							</h3>
							<button
								class="button button--nsYellow button--close"
								style="margin-left: 10px"
								(click)="closePopup.emit()"
							>
								<strong>&times;</strong>
							</button>
						</div>
						<div
							class="row"
							*ngIf="trainInformation.trainDetails?.materieeldelen && trainInformation.trainDetails?.materieeldelen[0]?.afbeelding"
						>
							<div id="carousel">
								<div
									class="slide"
									*ngFor="let railcar of trainInformation.trainDetails.materieeldelen; let isLast = last"
								>
									<img
										[src]="railcar.afbeelding"
										alt="Trein"
										height="45"
										[ngClass]="{ 'pr-2': isLast }"
									/>
								</div>
							</div>
						</div>
						<div class="row mt-2" style="margin-left: -15px">
							<div class="float-left">
								<div *ngIf="trainInformation.trainDetails.type">
									<div class="mb-1 font-weight-bold">Type:</div>
								</div>
								<div class="mb-1 font-weight-bold">Snelheid:</div>
								<div class="font-weight-bold">Richting:</div>
							</div>

							<div class="float-left ml-3">
								<div *ngIf="trainInformation.trainDetails.type">
									<div class="mb-1">{{trainInformation.trainDetails.type}}</div>
								</div>
								<div class="mb-1">{{ trainInformation.snelheid | number:'1.0-2' }} km/u</div>
								<div class="d-flex align-items-center">
									<span>{{ trainInformation.richting }}&deg;</span>
									<span
										class="material-icons font-weight-bold ml-1"
										style="font-size: 18px"
										[ngStyle]="directionArrowStyle"
										>arrow_right_alt</span
									>
								</div>
							</div>
						</div>
						<div class="row mt-2 justify-content-between">
							<div>
								<button
									id="moreInfoButton"
									class="button button--nsYellow"
									(click)="navigateToRideInformation()"
								>
									Meer info
									<fa-icon [icon]="faInfoCircle" style="font-size: small"></fa-icon>
								</button>
							</div>
							<div>
								<button
									id="shareTrainButton"
									class="button button--nsYellow"
									(click)="shareTrain(copiedShareUrlTpl)"
								>
									Deel trein
									<fa-icon [icon]="faShareSquare" style="font-size: small"></fa-icon>
								</button>
							</div>
						</div>
						<div class="row mt-2">
							<div class="ml-auto" style="align-self: flex-end" *ngIf="trainInformation.updatedAt">
								<div id="lastUpdated">Laatste update {{ updatedAt | date: "HH:mm:ss" }}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<span class="flex-child triangle triangle--d" style="color: #00337f"></span>
	</div>
</div>

<ng-template #copiedShareUrlTpl>
	<fa-icon [icon]="faCopy" style="font-size: small"></fa-icon>
	Link gekopieerd naar klembord
</ng-template>
